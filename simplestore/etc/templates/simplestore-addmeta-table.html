{# would have been easier if wtf bs let me pass in css classes to horizontal_field #}
{{ form.csrf_token }}

{% macro meta_field(f) %}
{% if f.type == 'HiddenField' %}
    <tr class="compact-form hidden">
        <td></td>
        <td></td>
        <td> {{f(**kwargs)|safe}} </td>
    </tr>
{% else %}

<tr>
<div class="compact-form {% if f.errors %}error{% endif %}">


<td>
  {{f.label(class="control-label meta-label")}}
</td>

<td>
  {%- if f.flags.required -%}
    <span style="color: red;">*</span>{%else%}<span>&nbsp;&nbsp;</span>{%- endif %}
</td>
<td>
    <div title="{{f.description}}" rel='tooltip' placement='right' container='body'> {{f(**kwargs)|safe}}</div>
</td>
  
  <div class="controls">

    {%- if f.errors %}
      {%- for error in f.errors %}
        <p class="help-block">{{error}}</p>
      {%- endfor %}
    {%- endif %}

  </div>
</div>
</tr>
{% endif %}
{% endmacro %}


{% for s in metadata.fieldsets %}
<fieldset>
    <legend>{{ s.name }} </legend>

<table>
    {% for f in s.basic_fields %}
        {{ meta_field(getattr(form, f)) }}
    {% endfor %}

    {% if s.optional_fields %}
      <button type="button" class="btn btn-success" data-toggle="collapse" data-target="#adv-fields-{{ s.name }}">
                    Add more details?
      </button>
</table>
      <div id="adv-fields-{{ s.name }}" class="collapse">
<table>
        {% for f in s.optional_fields %}
          {{ meta_field(getattr(form, f)) }}
        {% endfor %}
      </div>
    {% endif %}
</table>
  </fieldset>
{% endfor %}
<script type="text/javascript">
  $('.switch')['bootstrapSwitch']();

  $('.datepicker').datepicker({
      showButtonPanel: true,
      changeMonth: true,
      changeYear: true,
      dateFormat: 'dd-mm-yy',
      defaultDate: new Date()
    });
</script>

<script type="text/javascript">
  $(document).ready(function() {
    var elements = $("[rel='tooltip']");
    // the jquery ui tooltips are used here, not bootstrap
    elements.tooltip({
      position: {
        my: "right bottom",
        at: 'left-220px top'
      }
    });
  });
</script>

<script type="text/javascript">
    $(function(){
    $('select').change( function() {
        var value = $(this).val();
        if (value == 'other'){
           $("#"+this.name+"_input").show();
           $("#"+this.name+"_input").focus();
        }
        else{
           $("#"+this.name+"_input").hide();
        }
    });
});
</script>

<script type="text/javascript">
    var rowNum = 0;
    function addRow(frm, placeholder, name) {
        if (placeholder){
          placeholder = 'placeholder="'+placeholder+(rowNum+1)+'"';
        }
        rowNum ++;
        var row = '<p id="rowNum'+rowNum+'"><input type="text" name="'+name+'[]" '+placeholder+'>';
        row += '<input type="button" value="Remove" onclick="removeRow('+rowNum+');"></p>';
        jQuery('#itemRows').append(row);
    }
    
    function removeRow(rnum) {
        jQuery('#rowNum'+rnum).remove();
    }
</script>
